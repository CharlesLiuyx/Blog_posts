---
title: TensorSpace-3Dç¥ç»ç½‘ç»œå¯è§†åŒ–æ¡†æ¶
date: 2018-09-28 16:00:20
tags:
- Visualization
- Machine Learning
categories:
- Machine Learning
---

ã€é˜…è¯»æ—¶é—´ã€‘æ–‡æ¡£ä»‹ç»ç±»æ–‡ç« 
ã€é˜…è¯»å†…å®¹ã€‘TensorSpace - æ˜¯ä¸€æ¬¾3Dæ¨¡å‹å¯è§†åŒ–æ¡†æ¶ï¼Œæ”¯æŒå¤šç§æ¨¡å‹ï¼Œå¸®åŠ©ä½ å¯è§†åŒ–å±‚é—´è¾“å‡ºï¼Œæ›´ç›´è§‚çš„å±•ç¤ºæ¨¡å‹çš„è¾“å…¥è¾“å‡ºï¼Œå¸®åŠ©ç†è§£æ¨¡å‹ç»“æ„ï¼Œè¾“å‡ºæ–¹æ³•

<!-- more -->

# Conv2d ![#FFFF2E](https://placehold.it/15/FFFF2E/000000?text=+) 

## æ„é€ å™¨
```JavaScript
TSP.layers.Conv2d( { fileter : Int } )  
```

### å‚æ•°åˆ—è¡¨

#### â­ï¸ å¿…è¦å‚æ•°

> ä½¿ç”¨æ—¶å¿…é¡»æä¾›ï¼Œä¸èƒ½ä¸ºç©º
> åªè¦æä¾›äº†è¿™äº›å‚æ•°ï¼Œå°±èƒ½æ­£å¸¸åˆ›å»ºå®ä¾‹ï¼Œæ§åˆ¶å‚æ•°ä½¿ç”¨`é»˜è®¤å€¼`

[filters]() : `Int` ç‰¹å¾æå–è¿‡æ»¤å™¨çš„æ•°é‡

#### ğŸ”§ æ¨èå‚æ•°

> ä½¿ç”¨æ—¶æ¨èç»™å®šï¼Œæœªç»™å®šå¯ä»¥è¿è¡Œï¼Œä½†åœ¨ä½“éªŒå’Œæ˜“ç”¨æ€§ä¸Šæœ‰éšæ‚£

[name]() : `string` å±‚çš„å‘½åï¼Œå¼ºçƒˆå»ºè®®æ·»åŠ 

[padding]() : `string` æ˜¯å¦ä½¿ç”¨padding
- `valid`(default) ä¸ä½¿ç”¨paddingï¼Œä¸¢å¼ƒæ— æ³•æå–ç‰¹å¾çš„éƒ¨åˆ†ï¼Œä¼šæ”¹å˜è¾“å‡ºçš„å½¢çŠ¶
- `same` ä½¿ç”¨paddingï¼Œåœ¨ä¸å¤Ÿçš„ä½ç½®è¡¥é›¶ ï¼Œè¾“å‡ºçš„å½¢çŠ¶ä¸å˜

#### âš™ï¸å¯é€‰å‚æ•°

> æ ¹æ®æ¨¡å‹é…ç½®å‚æ•°**é€‰æ‹©æ€§æ·»åŠ **
> è¿™é‡Œçš„å‚æ•°å¯¹äºå±‚çš„ç»“æ„ï¼ˆ3Då¯è§†åŒ–å¤–è§‚ï¼‰æ²¡æœ‰å½±å“

[shape]() : `[Int]` 
- æœ‰æ­¤å‚æ•°ï¼Œä¼šè¦†ç›–é™¤äº†`filters`çš„å…¶ä»–å‚æ•°çš„å½±å“ï¼ŒDataformaté»˜è®¤é€šé“å€¼åœ¨æœ€å
- ä¾‹å¦‚ï¼Œä»¤`shape = [ 28, 28, 6 ]`ï¼Œåˆ™è¡¨ç¤ºè¾“å‡ºä¸º6ä¸ªç‰¹å¾å›¾ï¼Œæ¯å¹…å›¾å¤§å°`28*28` 

[kernelSize]() : `Int` å·ç§¯æ ¸çš„å°ºå¯¸ï¼Œ2då·ç§¯æ ¸ä¸ºæ­£æ–¹å½¢

[strides]() : `Int` å·ç§¯ç§»åŠ¨æ¡†çš„ç§»åŠ¨æ­¥é•¿ï¼Œåœ¨ä¸åŒæ–¹å‘çš„æ­¥é•¿ç›¸ç­‰

#### ğŸ¨ å¤–è§‚å‚æ•°

> å¯è¦†ç›–`TSP.model.Sequential`ä¸‹çš„å±æ€§è¿›è¡Œç»†è°ƒï¼Œ[è¯¦æƒ…ç‚¹å‡»]()

[color]() : `color format` å±‚çš„é¢œè‰²ï¼Œé»˜è®¤é¢œè‰²æ˜¯**äº®é»„è‰²** #FFFF2E

`closeButton` : `Dict` å±‚å…³é—­æŒ‰é’®å¤–è§‚æ§åˆ¶åˆ—è¡¨
- [display]() : `Bool` `true` æ˜¾ç¤ºæŒ‰é’® | `false` éšè—æŒ‰é’®
- [ratio]() : `Int` ä¸ºæ­£å¸¸å¤§å°çš„å‡ å€.ä¾‹å¦‚ï¼Œè®¾ä¸º2ä¸ºæ­£å¸¸å¤§å°çš„2å€å¤§
```javascript
closeButton {
    display: false,
    ratio: 2,
}
```

#### ğŸ¦ åŠ¨ç”»æ§åˆ¶å‚æ•°

> å¯è¦†ç›–`TSP.model.Sequential`ä¸‹çš„å±æ€§è¿›è¡Œç»†è°ƒï¼Œ[è¯¦æƒ…ç‚¹å‡»]()

[initStatus]() : `string` åˆå§‹åŒ–æ—¶ï¼Œæœ¬å±‚æ˜¯å¦æ”¶ç¼©
- `close`(default) : æ”¶ç¼©
- `open` : å±•å¼€

[animationTimeRatio]() : `Int` å¼ å¼€å’Œä¼¸ç¼©çš„è°ƒæ•´é€Ÿåº¦ï¼Œå‘ˆå€é€Ÿå…³ç³»ï¼Œä¾‹å¦‚2å°±æ˜¯2å€ï¼Œ**æ•°å­—è¶Šå¤§é€Ÿåº¦è¶Šå¿«**

### å‚æ•°åˆ—è¡¨

|        å‚æ•°å<br />æ ‡ç­¾         |      ç±»å‹      |               ç®€ä»‹               |                      å…·ä½“ç”¨æ³•ç»†èŠ‚å’Œä¾‹å­                      |
| :-----------------------------: | :------------: | :------------------------------: | :----------------------------------------------------------: |
|      [filters]() <br />â­ï¸ğŸ“¦       |     `Int`      |       ç‰¹å¾æå–è¿‡æ»¤å™¨çš„æ•°é‡       |                        `filters: 16`                         |
|        [name]() <br />ğŸ”§         |    `String`    |      å±‚çš„å‘½åï¼Œå¼ºçƒˆå»ºè®®æ·»åŠ       |                     `name: "layerName" `                     |
|      [padding]() <br />ğŸ”§ğŸ“¦       |    `String`    |         æ˜¯å¦ä½¿ç”¨padding          | `valid`[default] ä¸ä½¿ç”¨paddingï¼Œä¸¢å¼ƒæ— æ³•æå–ç‰¹å¾çš„éƒ¨åˆ†ï¼Œä¼šæ”¹å˜è¾“å‡ºçš„å½¢çŠ¶<br />`same` ä½¿ç”¨paddingï¼Œåœ¨ä¸å¤Ÿçš„ä½ç½®è¡¥é›¶ ï¼Œè¾“å‡ºçš„å½¢çŠ¶ä¸å˜ |
|       [shape]() <br />âš™ï¸ğŸ“¦        |    `[Int]`     |         å½“å‰å±‚çš„è¾“å‡ºå½¢çŠ¶         | æœ‰æ­¤å‚æ•°ï¼Œä¼šè¦†ç›–é™¤äº†`filters`çš„å…¶ä»–å‚æ•°çš„å½±å“<br />Dataformaté»˜è®¤é€šé“å€¼åœ¨æœ€å<br />ä¾‹å¦‚ï¼Œ`shape = [ 28, 28, 6 ]`ï¼Œåˆ™è¡¨ç¤ºè¾“å‡ºä¸º6ä¸ªç‰¹å¾å›¾ï¼Œæ¯å¹…å›¾å¤§å°`28*28` |
|     [kernelSize]() <br />âš™ï¸ğŸ“¦     |     `Int`      |           å·ç§¯æ ¸çš„å°ºå¯¸           |               2då·ç§¯æ ¸ä¸ºæ­£æ–¹å½¢ `kernelSize: 3`               |
|      [strides]() <br />âš™ï¸ğŸ“¦       |    `[Int]`     |       å·ç§¯ç§»åŠ¨æ¡†çš„ç§»åŠ¨æ­¥é•¿       |  åœ¨ä¸åŒæ–¹å‘çš„æ­¥é•¿ç›¸ç­‰ï¼Œé»˜è®¤æƒ…å†µè‡ªåŠ¨æ¨æ–­ `strides = [1, 1]`   |
|       [color]() <br />âš™ï¸ğŸ¨        | `color format` |             å±‚çš„é¢œè‰²             | `Conv2d`é»˜è®¤é¢œè‰²æ˜¯**äº®é»„è‰²** #FFFF2E![#FFFF2E](https://placehold.it/15/FFFF2E/000000?text=+) |
|     `closeButton`* <br />âš™ï¸ğŸ¨      |     `Dict`     |    å±‚å…³é—­æŒ‰é’®å¤–è§‚æ§åˆ¶**åˆ—è¡¨**    | [display]() : `Bool`  `true` [default] æ˜¾ç¤ºæŒ‰é’® `false` éšè—æŒ‰é’®<br />[ratio]() : `Int` ä¸ºæ­£å¸¸å¤§å°çš„å‡ å€ï¼Œé»˜è®¤ä¸º1å€<br />ä¾‹å¦‚ï¼Œè®¾ä¸º2ä¸ºæ­£å¸¸å¤§å°çš„2å€å¤§ |
|     [initStatus]() <br />âš™ï¸ğŸ¦     |    `String`    |      åˆå§‹åŒ–æ—¶ï¼Œæœ¬å±‚æ˜¯å¦æ”¶ç¼©      |           `close`[default] : æ”¶ç¼© | `open` : å±•å¼€            |
| [animationTimeRatio]() <br />âš™ï¸ğŸ¦ |     `Int`      | å¼ å¼€å’Œä¼¸ç¼©çš„è°ƒæ•´é€Ÿåº¦ï¼Œå‘ˆå€é€Ÿå…³ç³» |              ä¾‹å¦‚2å°±æ˜¯2å€ï¼Œ**æ•°å­—è¶Šå¤§é€Ÿåº¦è¶Šå¿«**              |

*`closeButton` ä¾‹å­
```javascript
closeButton {
    display: false,
    ratio: 2,
}
```
### æ ‡ç­¾è¯¦æƒ…

| ç¬¦å· | å‚æ•°æ€§è´¨ |                             è¯´æ˜                             |
| :--: | :------: | :----------------------------------------------------------: |
|  â­ï¸   |   å¿…è¦   | ä½¿ç”¨æ—¶å¿…é¡»æä¾›ï¼Œä¸èƒ½ä¸ºç©º<br/>åªè¦æä¾›äº†è¿™äº›å‚æ•°ï¼Œå°±èƒ½æ­£å¸¸åˆ›å»ºå®ä¾‹ï¼Œæ§åˆ¶å‚æ•°ä½¿ç”¨`é»˜è®¤å€¼` |
|  ğŸ”§   |   æ¨è   |  ä½¿ç”¨æ—¶æ¨èç»™å®šï¼Œæœªç»™å®šä¹Ÿå¯ä»¥è¿è¡Œï¼Œä½†åœ¨ä½“éªŒå’Œæ˜“ç”¨æ€§ä¸Šæœ‰éšæ‚£  |
|  âš™ï¸   |   å¯é€‰   | æ ¹æ®æ¨¡å‹é…ç½®å‚æ•°**é€‰æ‹©æ€§æ·»åŠ **<br/>è¿™é‡Œçš„å‚æ•°å¯¹äºå±‚çš„ç»“æ„ï¼ˆ3Då¯è§†åŒ–å¤–è§‚ï¼‰æ²¡æœ‰å½±å“ |
|  ğŸ“¦   |   æ¨¡å‹   |        é…ç½®å·ç§¯å±‚çš„ç›¸å…³å±æ€§ï¼Œå¹¶å¯¹è¾“å‡ºç‰¹å¾å›¾å½¢çŠ¶æœ‰å½±å“        |
|  ğŸ¨   |   å¤–è§‚   |  å¯è¦†ç›–`TSP.model.Sequential`ä¸‹çš„å±æ€§è¿›è¡Œç»†è°ƒï¼Œ[è¯¦æƒ…ç‚¹å‡»]()  |
|  ğŸ¦   | åŠ¨ç”»æ§åˆ¶ |  å¯è¦†ç›–`TSP.model.Sequential`ä¸‹çš„å±æ€§è¿›è¡Œç»†è°ƒï¼Œ[è¯¦æƒ…ç‚¹å‡»]()  |

### è°ƒç”¨ç»“æœ

- åˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œå¾€3Dåœºæ™¯ä¸­æ·»åŠ ä¸€ä¸ªæ–°çš„**3Då¯è§†åŒ–å·ç§¯å±‚**
- é»˜è®¤é¢œè‰²: #FFFF2E  ![#FFFF2E](https://placehold.it/15/FFFF2E/000000?text=+) 

<div align="left"><img src="https://github.com/zchholmes/tsp_image/blob/master/Document/Conv2D.png" alt="" width="700"></div>


## å±æ€§

### [.inputShape]() : [Int]

> åœ¨ `model.init()` åæ‰å¯æ‹¿åˆ°æ•°æ®ï¼Œå¦åˆ™ä¸º`undefined`

æœ¬å±‚**è¾“å…¥Tensor**çš„å½¢çŠ¶ï¼ŒDataformaté»˜è®¤é€šé“å€¼åœ¨æœ€åï¼Œä¾‹å¦‚`inputShape = [ 28, 28, 2 ]` è¡¨ç¤ºè¾“å…¥ä¸º`3`ä¸ªç‰¹å¾å›¾ï¼Œæ¯ä¸ªå›¾å¤§å°ä¸º`28*28`

### [.outputShape]() : [Int]

> åœ¨ `model.init()` åæ‰å¯æ‹¿åˆ°æ•°æ®ï¼Œå¦åˆ™ä¸º`undefined`

æœ¬å±‚**è¾“å‡ºTensor**çš„å½¢çŠ¶ï¼ŒDataformaté»˜è®¤é€šé“å€¼åœ¨æœ€åï¼Œä¾‹å¦‚`outputShape = [ 32, 32, 4 ]`  è¡¨ç¤ºç»è¿‡æ­¤å±‚å¤„ç†åï¼Œæœ‰`4`ä¸ªç‰¹å¾å›¾ï¼Œæ¯ä¸ªå›¾å¤§å°ä¸º`32*32`

### [.neuralValue]() : [float32]

> è½½å…¥æ¨¡å‹ï¼Œåœ¨ `model.predict()` åæ‰å¯ä»¥æ‹¿åˆ°æ•°æ®ï¼Œå¦åˆ™ä¸º`undefined`

æœ¬å±‚çš„**å±‚é—´è¾“å‡º**å€¼æ•°ç»„

### [.name]() : string

> åˆ›å»ºåå³å¯å–åˆ°

æœ¬å±‚çš„è‡ªå®šä¹‰åç§°

### [.layerType]() : string

> åˆ›å»ºåå³å¯å–åˆ°

æœ¬å±‚çš„ç±»å‹ï¼Œè¿”å›ä¸€ä¸ªå®šå€¼ï¼Œå­—ç¬¦ä¸²`Conv2d`

## æ–¹æ³•

### [.openLayer()]() : void

ï¼ˆ1ï¼‰é€šè¿‡ç›´æ¥å’Œ3dåœºæ™¯ä¸­ç‰©ä½“äº¤äº’`ç›´æ¥ç‚¹å‡»å±‚`æ‰“å¼€

<div align="left"><img src="https://github.com/zchholmes/tsp_image/blob/master/Document/Conv2d-open.gif" alt="" width="400"></div>

ï¼ˆ2ï¼‰ä»£ç ä¸­é€šè¿‡è°ƒç”¨æ–¹æ³•æ‰“å¼€

```javascript
model.init();
TSP.layers.Conv2d.openLayer()
```

### [.closeLayer()]() : void

ï¼ˆ1ï¼‰é€šè¿‡ç›´æ¥å’Œ3dåœºæ™¯ä¸­ç‰©ä½“äº¤äº’`ç‚¹å‡»æŒ‰é’®`å…³é—­

<div align="left"><img src="https://github.com/zchholmes/tsp_image/blob/master/Document/Conv2d-close.gif" alt="" width="400"></div>

ï¼ˆ2ï¼‰ä»£ç ä¸­é€šè¿‡è°ƒç”¨æ–¹æ³•æ‰“å¼€

```javascript
model.init();
// if this layer already opened
TSP.layers.Conv2d.closeLayer()
```

## ä½¿ç”¨æ ·ä¾‹

### æ·»åŠ å±‚

ï¼ˆ1ï¼‰å£°æ˜ä¸€ä¸ª`Conv2D`çš„å®ä¾‹ï¼Œæ–¹ä¾¿å¤ç”¨

```javascript
let convLayer = new TSP.layers.Conv2d({
    kernelSize: 5,
    filters: 6,
    strides: 1,
    animationTimeRatio: 2,
    name: "conv2d1",
    initStatus: "open",
});
model.add(convLayer);
```

ï¼ˆ2ï¼‰ç›´æ¥æ·»åŠ `Conv2D`

```javascript
model.add(new TSP.layers.Conv2d({
    kernelSize: 5,
    filters: 16,
    strides: 1,
    name: "conv2d2"
}));
```

### ä»€ä¹ˆæ—¶å€™ç”¨

å¦‚æœä½ æ˜¯`Keras` | `TensorFlow` | `tfjs` æ¡†æ¶çš„ä½¿ç”¨è€…ï¼Œæ„å»ºæ¨¡å‹æ—¶ä½¿ç”¨äº†**å·ç§¯å±‚**`Conv2D`ï¼ˆä¸‹è¡¨åˆ—å‡ºäº†å¯èƒ½çš„ä½¿ç”¨æƒ…æ™¯ï¼‰ã€‚ä¸€ä¸€å¯¹åº”çš„ï¼Œåœ¨`TensorSpace`ä¸­ï¼Œä½ åº”è¯¥ä½¿ç”¨æ­¤API

| æ¡†æ¶åç§° | æ–‡æ¡£æ ¼å¼ | æ ·ä¾‹ä»£ç æ®µ |
| :---: | :---: | :---: |
| [Keras](https://keras.io/layers/convolutional/) | keras.layers.Conv2D([filters](), [kernel_size](), [strides]()=(1, 1)) | model.add(Conv2D(32, (3, 3))) |
| [TensorFlow](https://www.tensorflow.org/api_docs/python/tf/nn/conv2d) | tf.nn.conv2d(input, [filter](), [strides](), [padding]()) | x = tf.nn.conv2d(x, W, strides=[1, strides, strides, 1], padding='SAME') |
| [TensorFlow.js](https://js.tensorflow.org/api/0.13.0/#layers.conv2d) | tf.layers.conv2d ([filters](), [kernelSize]()) | model.add(tf.layers.conv2d({kernelSize: 3, filters: 32, activation: 'relu'})); |

### æºç 

[tensorspace/src/layer/intemediate/Conv2d.js](https://github.com/syt123450/tensorspace/blob/master/src/layer/intemediate/Conv2d.js)